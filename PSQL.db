--Create table and values with reset

DROP TABLE IF EXISTS person CASCADE;
DROP TABLE IF EXISTS parentChild CASCADE;

CREATE TABLE person (
	id SERIAL NOT NULL PRIMARY KEY,
	firstName VARCHAR(50),
	lastName VARCHAR(50),
	dateOfBirth DATE
);

CREATE TABLE parentChild (
	id SERIAL NOT NULL PRIMARY KEY,
	parent_id INTEGER NOT NULL REFERENCES person (id),
	child_id INTEGER NOT NULL REFERENCES person (id)
);

INSERT INTO person (firstName, lastName, dateOfBirth) VALUES ('Collin', 'Blake', '01-01-1991');
INSERT INTO person (firstName, lastName, dateOfBirth) VALUES ('Amber', 'Blake', '02-04-1985');
INSERT INTO person (firstName, lastName, dateOfBirth) VALUES ('Kaladin', 'Blake', '04-23-2019');
INSERT INTO parentChild (parent_id, child_id) VALUES ('1', '3');
INSERT INTO parentChild (parent_id, child_id) VALUES ('2', '3');


--Project Table creation
DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS groups CASCADE;
DROP TABLE IF EXISTS user_groups CASCADE;
DROP TABLE IF EXISTS tasks CASCADE;


CREATE TABLE users (
	id SERIAL NOT NULL PRIMARY KEY,
	name VARCHAR(30) NOT NULL,
	username VARCHAR(30) NOT NULL UNIQUE,
	password TEXT NOT NULL
);

CREATE TABLE groups (
	id SERIAL NOT NULL PRIMARY KEY,
	name VARCHAR(30) NOT NULL,
	admin_id INTEGER NOT NULL REFERENCES users (id)
);

CREATE TABLE user_groups (
	id SERIAL NOT NULL PRIMARY KEY,
	user_id INTEGER NOT NULL REFERENCES users (id),
	group_id INTEGER NOT NULL REFERENCES groups (id)
);

CREATE TABLE tasks (
	id SERIAL NOT NULL PRIMARY KEY,
	user_id INTEGER NOT NULL REFERENCES users (id),
	group_id INTEGER NOT NULL REFERENCES groups (id),
	task_name VARCHAR(30) NOT NULL,
	dueDate DATE DEFAULT CURRENT_DATE,
	timespan INTEGER DEFAULT 0,
	completed BOOLEAN DEFAULT FALSE
);

--Test Buddy data to add
INSERT INTO users (name, username, password)
VALUES
	('test buddy1', 'testbuddy1', 'password'),
	('test buddy2', 'testbuddy2', 'password'),
	('test buddy3', 'testbuddy3', 'password');
	
INSERT INTO groups (name, admin_id)
VALUES
	('Test Buddies Unite', '1');
	
INSERT INTO user_groups (user_id, group_id)
VALUES 
	('1', '1'),
	('2', '1'),
	('3', '1');
	
INSERT INTO tasks (user_id, group_id, task_name, dueDate)
VALUES 
	('1', '1', 'Honey do1', '2020-11-25'),
	('1', '1', 'Honey do2', '2020-11-30'),
	('2', '1', 'Honey do3', '2020-12-05'),
	('2', '1', 'Honey do4', '2020-12-10'),
	('3', '1', 'Honey do5', '2020-12-15'),
	('3', '1', 'Honey do6', '2020-12-20');
	